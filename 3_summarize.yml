target_default: 3_summarize

packages:
  - dplyr
  - feather
  - readr
  - tidyr

sources:
  - 3_summarize/src/combine_files_to_zip.R
  - 3_summarize/src/calculate_total_benthic_area.R
  - 2_process/src/calculate_toha.R # Has the benthic area fxn & resample_hypso
  - 3_summarize/src/annual_thermal_metrics.R
  - 3_summarize/src/do_annual_thermal_metric_tasks.R
  - 3_summarize/src/summarize_clarity_scenarios.R

targets:
  3_summarize:
    depends:
      - 3_summarize/out/oha_metrics_by_lake.csv
      - 3_summarize/out/oha_by_lake_scenario.csv
      - 3_summarize/out/oha_annual_scenarios.csv

 ## Calculate total benthic area to use with OHA areas --> OHA as % Benthic Area ##
  
  3_summarize/out/total_benthic_areas.csv:
    command: calculate_total_benthic_area(
      target_name = target_name,
      morphometry = morphometry)
      
  # create new summary that calculates annual optical habitat
  # per year and clarity scenario
  # and divides by total benthic area
  3_summarize/out/oha_annual_scenarios.csv:
    command: calc_annual_oha(
      out_file = target_name,
      lake_crosswalk = '1_fetch/out/lake_metadata.csv',
      files_to_munge_ind = '2_process/out/2_pgdl_lake_tasks.ind',
      benthic_area = '3_summarize/out/total_benthic_areas.csv')
      
  3_summarize/out/oha_by_lake_scenario.csv:
    command: collapse_annual_oha(
      out_file = target_name,
      lake_crosswalk = '1_fetch/out/lake_metadata.csv',
      data_in = '3_summarize/out/oha_annual_scenarios.csv')
      
  3_summarize/out/oha_metrics_by_lake.csv:
    command: calc_oha_metrics(
      oha_annual = '3_summarize/out/oha_annual_scenarios.csv',
      mod_clarity = '2_process/out/annual_clarity_modeled.csv',
      out_file = target_name)

 
  
  ## Calculate a collection of annual thermal metrics
  
  # Based these additional metrics on the ones included in a previous lake modeling
  # data release (see https://www.sciencebase.gov/catalog/item/57d9e887e4b090824ffb1098)

  # temp_range_info:
  #   command: read_tsv("3_summarize/in/temp_ranges_for_metrics.txt")
  # temp_ranges:
  #   command: select(temp_range_info, I('Temp_Low'), I('Temp_High'))
  # 
  # 3_summarize/out/annual_metrics_pgdl.csv:
  #   command: do_annual_metrics_multi_lake(
  #     final_target = target_name,
  #     site_file_yml = "2_process/out/2_pgdl_grp_tasks_completed.yml",
  #     ice_file_yml = "2_process/out/iceflags_unzipped.yml",
  #     n_cores = 40,
  #     morphometry = morphometry,
  #     temp_ranges = temp_ranges,
  #     '2_process/src/calculate_toha.R',
  #     '3_summarize/src/annual_thermal_metrics.R',
  #     '3_summarize/src/do_annual_thermal_metric_tasks.R')
  
  

